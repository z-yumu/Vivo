<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>员工后台管理</title>
		<meta name="description" content="overview &amp; stats" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="/static/admin/assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="/static/admin/assets/font-awesome/4.5.0/css/font-awesome.min.css" />
		<!-- page specific plugin styles -->
		<!-- text fonts -->
		<link rel="stylesheet" href="/static/admin/assets/css/fonts.googleapis.com.css" />
		<!-- ace styles -->
		<link rel="stylesheet" href="/static/admin/assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />
		<!--[if lte IE 9]>
			<link rel="stylesheet" href="/static/admin/assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
		<![endif]-->
		<link rel="stylesheet" href="/static/admin/assets/css/ace-skins.min.css" />
		<link rel="stylesheet" href="/static/admin/assets/css/ace-rtl.min.css" />
		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->
		<!-- inline styles related to this page -->
		<!-- ace settings handler -->
		<script src="/static/admin/assets/js/ace-extra.min.js"></script>
		  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js"></script>
		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->
		<!--[if lte IE 8]>
		<script src="/static/admin/assets/js/html5shiv.min.js"></script>
		<script src="/static/admin/assets/js/respond.min.js"></script>
		<![endif]-->
</head>
<div class="main-content">
<div class="main-content-inner">
<div class="breadcrumbs ace-save-state" id="breadcrumbs">
<ul class="breadcrumb">
	<li>
		<i class="ace-icon fa fa-home home-icon"></i>
		<a href="#">主页</a>
	</li>

	<li>
		<a href="#">产品管理</a>
	</li>
	<li class="active">添加产品</li>
</ul><!-- /.breadcrumb -->


</div>

<div class="page-content">
<div class="ace-settings-container" id="ace-settings-container">

	<div class="ace-settings-box clearfix" id="ace-settings-box">
		<div class="pull-left width-50">
			<div class="ace-settings-item">
				<div class="pull-left">
					<select id="skin-colorpicker" class="hide">
						<option data-skin="no-skin" value="#438EB9">#438EB9</option>
						<option data-skin="skin-1" value="#222A2D">#222A2D</option>
						<option data-skin="skin-2" value="#C6487E">#C6487E</option>
						<option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
					</select>
				</div>
				<span>&nbsp; Choose Skin</span>
			</div>

			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-navbar" autocomplete="off" />
				<label class="lbl" for="ace-settings-navbar"> Fixed Navbar</label>
			</div>

			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-sidebar" autocomplete="off" />
				<label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
			</div>

			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-breadcrumbs" autocomplete="off" />
				<label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
			</div>

			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl" autocomplete="off" />
				<label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
			</div>

			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-add-container" autocomplete="off" />
				<label class="lbl" for="ace-settings-add-container">
					Inside
					<b>.container</b>
				</label>
			</div>
		</div><!-- /.pull-left -->

		<div class="pull-left width-50">
			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-hover" autocomplete="off" />
				<label class="lbl" for="ace-settings-hover"> Submenu on Hover</label>
			</div>

			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-compact" autocomplete="off" />
				<label class="lbl" for="ace-settings-compact"> Compact Sidebar</label>
			</div>

			<div class="ace-settings-item">
				<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-highlight" autocomplete="off" />
				<label class="lbl" for="ace-settings-highlight"> Alt. Active Item</label>
			</div>
		</div><!-- /.pull-left -->
	</div><!-- /.ace-settings-box -->
</div><!-- /.ace-settings-container -->
<div class="page-header">
	<h1>
		当前类目
		<small>
			<i class="ace-icon fa fa-angle-double-right"></i>
			{$bid|categoryname} —>{$sid|categoryname} <a href="{:url('product/shipin')}" target="content"></a>
		</small>
	</h1>
</div><!-- /.page-header -->
<div class="page-header">
	<h1 style="font-size: 20px;font-weight: lighter;color: rgb(38, 121, 181);padding: 0px;margin: 0px 260px 0px;">
		基础信息:
	</h1>
</div><!-- /.page-header -->

<div class="row">
	<div class="col-xs-12">
		<!-- PAGE CONTENT BEGINS -->
		<form name="form" action="{:url('product/save')}" method="post" onsubmit="return check()" class="form-horizontal" role="form">
			<div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>产品名称： </label>
				<div class="col-sm-6">
					<input name="name"  type="text" id="name" placeholder="最多允许输入30个汉字"  onkeyup="myFunction()" class="col-xs-10 col-sm-11" maxlength="30"/>
					<span class="help-inline col-xs-12 col-sm-7">
					   剩余字数<span class="middle" id="changdu">0</span>/30
					</span>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>产品子类： </label>
				<div class="col-sm-6">
					<select name="categorysmall_id"  style="width:150px">
					    <option value="">请选择</option>
	                 {volist name=":categorysmall($sid)" id="vo"}    
                        <option value="{$vo.id}">{$vo.name}</option>
                    {/volist}      
		            </select>     
				</div>
			</div>
			<div class="form-group">
<!--			  -->
<!--				    <div style="width:48%; float:left;margin:0px 0">-->
<!--				     <label class="col-sm-4 control-label no-padding-right" for="form-field-1">  品牌： </label>-->
<!--					<select name="categorybrand_id"  style="width:150px">-->
<!--					    <option value="">请选择</option>-->
<!--	                 {volist name=":categorybrand($sid)" id="vo"}    -->
<!--                        <option value="{$vo.id}">{$vo.name}</option>-->
<!--                    {/volist}      -->
<!--		            </select>-->
<!--		            </div>-->
<!--                    {volist name=":categoryattribute($sid)" id="vo1"}-->
<!--                     <div style="width:48%; float:left;margin:5px 0;">-->
<!--                     <label class="col-sm-4 control-label no-padding-right" for="form-field-1"> {$vo1.name}：</label>-->
<!--		            <input name="categoryattribute_id[]" value="{$vo1.id}" type="hidden"/>-->
<!--		            <select name="categoryattributevalue_id[]"  style="width:150px" >-->
<!--		                <option value="">请选择</option>-->
<!--		                {volist name="vo1['child']" id="sub1"}     -->
<!--                        <option value="{$sub1.id}">{$sub1.name}</option>-->
<!--                        {/volist} -->
<!--		            </select>-->
<!--		            </div>  -->
		            {/volist}  
		             
				</div>
			</div>
            <div class="page-header">
				<h1 style="font-size: 20px;font-weight: lighter;color: rgb(38, 121, 181);padding: 0px;margin: 0px 260px 0px;">
					销售信息:
				</h1>
			</div><!-- /.page-header -->
        {volist name=":salesattribute($sid)" id="vo2" key="k"}
            <div class="div_contentlist"> 
            <div class="form-group">
                 <label class="col-sm-3 control-label no-padding-right" for="form-field-1">  
                    <div class="Father_Title"> 
                    <input name="salesattribute_id[]" type="hidden" value="{$vo2.sales_attribute_id}"> 
                        <a>{$vo2.sales_attribute_id|salesattributename}</a>:  
                    </div>  
                    </label>
                    <div class="col-sm-6">
                    <div class="Father_Item{$k-1}">  
                    {volist name="vo2['child']" id="vo3"}
                    <div style="width:20%; float:left;margin:0px 0;">
			        <div class="checkbox">
						<label>
							<input name="salesattributevalue[]" value="{$vo3.name}" type="checkbox" class="ace" id="salesattribute"/>
							<span class="lbl">{$vo3.name}</span>
						</label>    
                    </div> 
			        </div>   
                    {/volist} 
                    </div> 
			        </div>

			</div>
		    </div>
			{/volist}
			 <div class="form-group">
               <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> </label>
                <div class="col-sm-6">
	                 <div id="createTable">  
                     </div>  
                </div> 
             </div> 
			 
			<div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>一口价 ：</label>

				<div class="col-sm-9">
					<input name="price" type="text" id="price" placeholder="价格" oninput="inputnum(this)" class="col-xs-10 col-sm-3" />
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>总数量 ：</label>

				<div class="col-sm-9">
                    <div id="total">
					<input name="total" type="text" id="total" value="0" placeholder="数量" class="col-xs-10 col-sm-3" onkeyup="this.value=this.value.replace(/\D/g,'')" />
                     </div>
				</div>
			</div>
			<div class="page-header">
				<h1 style="font-size: 20px;font-weight: lighter;color: rgb(38, 121, 181);padding: 0px;margin: 0px 260px 0px;">
					图文信息:
				</h1>
			</div><!-- /.page-header -->
             <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>产品缩略图： </label>
                <div class="col-xs-2">
                    <label class="ace-file-input ace-file-multiple"><input type="file" class="file" name="image" id="file"><span class="ace-file-container" data-title="上传"><span class="ace-file-name" data-title="No File ..."><i class=" ace-icon ace-icon fa fa-cloud-upload"></i></span></span><a class="remove" href="#"><i class=" ace-icon fa fa-times">上传</i></a></label>
                </div>
            </div>

            <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> </label>
                <div class="col-xs-9">
                <div id="content"></div>  
                </div>
            </div>
            <div id="picturebig"></div>
            <div id="picturesmall"></div>
            <div id="picturefang"></div>
            <div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>产品详情 ：</label>
				<div class="col-sm-9">
					<!-- 加载编辑器的容器 -->
				    <script id="container" name="content" type="text/plain">
				        
				    </script>
				    <!-- 配置文件 -->
				    <script type="text/javascript" src="/static/admin/assets/bianjiqi/ueditor.config.js"></script>
				    <!-- 编辑器源码文件 -->
				    <script type="text/javascript" src="/static/admin/assets/bianjiqi/ueditor.all.js"></script>
				    <!-- 实例化编辑器 -->
				    <script type="text/javascript">
				        var ue = UE.getEditor('container');
				    </script>

				</div>
			</div>   
		<div class="page-header">
				<h1 style="font-size: 20px;font-weight: lighter;color: rgb(38, 121, 181);padding: 0px;margin: 0px 260px 0px;">
					物流信息:
				</h1>
			</div><!-- /.page-header -->
			<div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>产品地区 ：</label>
					<div class="col-sm-9">
			            <!--省份选择-->
			            <select name="province" id="prov" onchange="showCity(this)">
			                <option value="">=请选择省份=</option>
			            </select>
			            <!--城市选择-->
			            <select name="city" id="city" onchange="showCountry(this)">
			                <option value="">=请选择城市=</option>
			            </select>
			            <!--县区选择-->
			            <select name="country" id="country" onchange="selecCountry(this)">
			                <option value="">=请选择县区=</option>
			            </select> 
                 </div>	
			</div>
            <div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>提取方式 ：</label>

				<div class="col-sm-7">
				    <div style="width:20%; float:left;margin:0px 0;">
					<div class="radio">
						<label>
							<input name="extract" value="1" type="radio" class="ace" id="" checked/>
							<span class="lbl"> 物流配送</span>
						</label>
					</div>
				    </div>
				    <div style="width:20%; float:left;margin:0px 0;">
					<div class="radio">
						<label>
							<input name="extract" value="0" type="radio" class="ace" id="" />
							<span class="lbl"> 上门取货</span>
						</label>
					</div>
					</div>
					
				</div>
			</div>
            <div class="form-group">
               <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>是否包邮 ：</label>
               <div class="col-sm-7">
                        <div style="width:20%; float:left;margin:0px 0;">
	                    <div class="radio">
		                    <label>
		                    <input name="transportfree" value="0" type="radio" class="ace" id="no" checked/>
		                    <span class="lbl"> 定义运费</span>
		                    </label>
	                    </div>
                    </div>
	                    <div style="width:20%; float:left;margin:0px 0;">
	                    <div class="radio">
		                    <label>
		                    <input name="transportfree" value="1" type="radio" class="ace" id="yes"/>
<!--		                    <span class="lbl"> 包邮</span>-->
		                    </label>
	                    </div>
                    </div>
                   
                </div>
            </div>
            <div class="form-group">
	            <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> <font color="#F00">*</font>运费 ：
	            </label>
	            <div class="col-sm-9">
		            <div id="yunfei">
		               <input name="fare" oninput="inputnum(this)" type="text" id="fare" placeholder="0" class="col-xs-10 col-sm-3"/
		            </div>
	            </div>
            </div>      
		<div class="page-header">
				<h1 style="font-size: 20px;font-weight: lighter;color: rgb(38, 121, 181);padding: 0px;margin: 0px 260px 0px;">
					售后服务:
				</h1>
			</div><!-- /.page-header -->
              <div class="form-group">
				<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> 售后服务 ：</label>
                <div class="col-sm-9">
				<div class="checkbox">
					<label>
						<input name="service[]" value="1" type="checkbox" class="ace" />
						<span class="lbl"> 提供发票</span>
					</label>
				</div>
				<div class="checkbox">
					<label>
						<input name="service[]" value="2" type="checkbox" class="ace" />
						<span class="lbl"> 保修服务</span>
					</label>
				</div>
				<div class="checkbox">
					<label>
						<input name="service[]" value="3" type="checkbox" class="ace" />
						<span class="lbl"> 退换货承诺</span>
					</label>
				</div>
                </div>
			</div>  
			{:token()}
			<input name="category_id" type="hidden" value="{$bid}">
			<input name="se_category_id" type="hidden" value="{$sid}">
			
			<div class="clearfix form-actions">
				<div class="col-md-offset-3 col-md-9">
					<button class="btn btn-info" type="submit">
						<i class="ace-icon fa fa-check bigger-110"></i>
						提交
					</button>

					&nbsp; &nbsp; &nbsp;
					<button class="btn" type="reset">
						<i class="ace-icon fa fa-undo bigger-110"></i>
						重置
					</button>
				</div>
			</div>
		<!-- </form> -->
	</div><!-- /.col -->
</div><!-- /.row -->
</div><!-- /.page-content -->
</div>
</div><!-- /.main-content -->

<script src="/static/admin/assets/liandong/city.js"></script>
<script src="/static/admin/assets/liandong/method011.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js"></script>
<!--<script src="/static/admin/assets/liandong/table.js"></script>-->
<script type="text/javascript"> 
//显示产品名称剩余字数 
function myFunction(){
	var x=document.getElementById("name").value;
	a=30-x.length;
    $('#changdu').html(a);
}  
//显示产品价格只能是两位小数的数字
function inputnum(obj,val){
        obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
        obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字
        obj.value = obj.value.replace(/\.{2,}/g,""); //只保留第一个, 清除多余的
        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); //只能输入两个小数
    }
</script>
<script type="text/javascript">
$('#yes').change(function(){
        var html='<input name="companylicense" type="text" id="companylicense" placeholder="0" class="col-xs-10 col-sm-3" readonly />';
        $('#yunfei').html(html);  
 });
$('#no').change(function(){
        var html='<input name="companylicense" type="text" id="companylicense" placeholder="0" class="col-xs-10 col-sm-3"/>';
        $('#yunfei').html(html);  
 });
function showsum(obj,val) {
obj.value = obj.value.replace(/\D/g,''); //	
var sum = 0;
$(".inittextValue").each(function() {
    var num = $(this).val();
    if (num == "" || num == null) {
        num = 0;
    }
    sum += parseFloat(num); 
   $("input[name='total']").val(sum);
  });
}

var num2 = 0; 
$('#file').change(function(){
     num2++; 
     if(num2<6){
     ajaxPost(); 
     }else{
      alert("最多传5张图片");
    }
 });
function ajaxPost(){
  var formData=new FormData();
  if($('#file')[0].files.length<=0){
    alert("请选择文件");
    return;
   }
   formData.append('image',$('#file')[0].files[0]);
   $.ajax({
     type:'post',
     url:"{:url('Product/picture')}",
     data:formData,
     cache:false,
     processData:false,
     contentType:false,
     success:function(data){
       var html='<div class="col-xs-2"><label class="ace-file-input ace-file-multiple"><img src="'+data.srcbig+'" width="120" height="120"></label><input name="Fruit" type="radio" value="'+data.srcbig+'" checked/>设为主图</div>';
       var picturebig=' <input name="picturebig[]" type="hidden" value="'+data.srcbig+'" id="picturebigtu">';
       var picturesmall=' <input name="picturesmall[]" type="hidden" value="'+data.srcsmall+'" id="picture">';
       var picturefang=' <input name="picturefang[]" type="hidden" value="'+data.srcfang+'" id="picture">';
        $('#content').append(html);
        $('#picturebig').append(picturebig);
        $('#picturesmall').append(picturesmall);
        $('#picturefang').append(picturefang);
     }
   })
}
</script>

<SCRIPT language="JavaScript">  
function check(){
	if(document.form.name.value==""){  
         alert("产品名称不能为空"); 
         $('#name').focus();
        return false;  
    }
	//产品子类为空
    // if(document.form.categorysmall_id.value==""){
    //      alert("产品子类不能为空");
    //      $('#name').focus();
    //     return false;
    // }
    if("salesattributevalue[]" in document.form) 
	{ 
       //销售属性存在
       if("prices[]" in document.form){
        	//价格存在
         }else{
         	var id = document.getElementsByName('salesattributevalue[]');
		    var value = new Array();
		    for(var i = 0; i < id.length; i++){
		         if(id[i].checked)
		         value.push(id[i].value);
		    } 
		    if(value==""){
		    //没有选择销售属性
		    }else{
		    	alert("销售属性请全选或者全不选（如销售属性有颜色、尺码，那么必须两样都勾选填写或者全部不勾选，不能只勾选其中一项）");
                document.getElementById("salesattribute").focus();
                 return false; 
		    }
         }
	}
    if(document.form.price.value==""){  
         alert("一口价不能为空"); 
         $('#price').focus();
        return false;  
    } 
    if(document.form.total.value==""){  
         alert("产品数量不能为空"); 
         $('#total').focus();
        return false;  
    } 
    if("picturebig[]" in document.form) 
	{ 
		//存在
	}else{ 
        alert("产品缩略图必须上传"); 
        document.getElementById("file").focus();
        return false; 
	} 

	var content = ue.getContent();
	if(content == ''){
	   alert('内容不能为空...');
	   ue.focus();  
	   return false;
	}
    if(document.form.province.value==""){  
         alert("产品省份不能为空"); 
         $('#prov').focus();
        return false;  
    } 
    if(document.form.city.value==""){  
         alert("产品城市不能为空"); 
         $('#city').focus();
        return false;  
    }  
    if(document.form.country.value==""){  
         alert("产品区县不能为空"); 
         $('#country').focus();
        return false;  
    } 
    if(document.form.fare.value==""){
         alert("运费不能为空");
         $('#fare').focus();
        return false;
    }
    
    return true;  
} 
</SCRIPT>
